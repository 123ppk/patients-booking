<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Clinic Appointment System</title>
<style>
body{font-family:'Segoe UI',sans-serif;margin:0;padding:0;background:#fff;color:#000;min-height:100vh;display:flex;flex-direction:column;}
header{padding:10px 20px;text-align:center;font-size:20px;font-weight:600;position:relative;background:#f1f5ff;}
header button.logout{position:absolute;right:8px;top:8px;border:1px solid #dc2626;color:#dc2626;background:#fff;padding:2px 6px;border-radius:4px;font-size:11px;cursor:pointer;display:none;width:auto;}
.container{flex:1;padding:15px;display:flex;flex-direction:column;align-items:center;justify-content:center;}
form{padding:15px;background:#fff;border-radius:10px;border:1px solid #ddd;margin-bottom:10px;width:100%;max-width:350px;box-sizing:border-box;}
input,select,button{padding:6px;margin:5px 0;width:100%;border-radius:6px;border:1px solid #ddd;box-sizing:border-box;font-size:13px;}
input:focus,select:focus{border-color:#2563eb;outline:none;}
button{cursor:pointer;}
button.outline{border:1px solid #2563eb;background:#fff;color:#2563eb;font-weight:500;}
button.outline:hover{background:#2563eb;color:#fff;}
.admin-dashboard{display:flex;width:100%;gap:15px;align-items:flex-start;flex-wrap:wrap;}
.forms{flex:1;min-width:280px;max-width:320px;display:flex;flex-direction:column;max-height:600px;overflow-y:auto;}
.cards-container{flex:2;display:flex;flex-direction:column;align-items:center;max-height:600px;overflow-y:auto;width:100%; }
.cards{display:flex;flex-wrap:wrap;gap:12px;justify-content:flex-start;}
.card{background:#fff;padding:10px;border-radius:10px;border:1px solid #ddd;min-width:220px;max-width:260px;text-align:left;font-size:13px;flex:1;}
.card h3{margin:5px 0;font-size:15px;color:#000;}
.card p{margin:3px 0;font-size:13px;color:#000;}
.card button{padding:4px 8px;font-size:12px;margin:3px;}
#searchBox{width:90%;max-width:400px;padding:6px;border-radius:6px;border:1px solid #ccc;margin:5px auto 10px auto;font-size:13px;display:block;}
#authPage,#adminPage,#doctorPage,#patientPage{width:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;}
@media(max-width:800px){.admin-dashboard{flex-direction:column;align-items:center;}.cards-container{align-items:center;}.cards{justify-content:center;}}
</style>
</head>
<body>
<header>
Clinic Appointment System
<button class="logout" onclick="logout()" id="logoutBtn">Logout</button>
</header>

<div class="container">
<div id="authPage">
<form id="loginForm">
<h2>Login</h2>
<input type="email" id="loginEmail" placeholder="Email" required>
<input type="password" id="loginPassword" placeholder="Password" required>
<select id="loginRole">
<option value="admin">Admin</option>
<option value="doctor">Doctor</option>
<option value="patient">Patient</option>
</select>
<button type="submit" class="outline">Login</button>
</form>
</div>

<div id="adminPage" style="display:none;width:100%;">
<div class="admin-dashboard">
<div class="forms">
<form id="clinicForm">
<h3>Add Clinic</h3>
<input type="text" id="clinicName" placeholder="Clinic Name" required>
<input type="text" id="clinicAddress" placeholder="Clinic Address" required>
<input type="text" id="clinicPhone" placeholder="Phone No" required>
<button type="submit" class="outline">Add Clinic</button>
</form>
<form id="doctorForm">
<h3>Add Doctor</h3>
<input type="text" id="doctorName" placeholder="Doctor Name" required>
<input type="email" id="doctorEmail" placeholder="Doctor Email" required>
<input type="password" id="doctorPassword" placeholder="Doctor Password" required>
<select id="doctorClinic"></select>
<button type="submit" class="outline">Add Doctor</button>
</form>
<form id="patientForm">
<h3>Add Patient</h3>
<input type="text" id="patientName" placeholder="Patient Name" required>
<input type="email" id="patientEmail" placeholder="Patient Email" required>
<input type="password" id="patientPassword" placeholder="Patient Password" required>
<input type="text" id="patientPhone" placeholder="Phone No" required>
<input type="number" id="patientAge" placeholder="Age" required>
<input type="text" id="patientProblem" placeholder="Problem" required>
<input type="date" id="patientDate" required>
<input type="time" id="patientTime" required>
<select id="patientDay" required>
<option value="">Select Day</option>
<option>Monday</option>
<option>Tuesday</option>
<option>Wednesday</option>
<option>Thursday</option>
<option>Friday</option>
<option>Saturday</option>
<option>Sunday</option>
</select>
<input type="text" id="patientAddress" placeholder="Address" required>
<select id="patientDoctor"></select>
<button type="submit" class="outline">Add Patient</button>
</form>
</div>
<div class="cards-container">
<input type="text" id="searchBox" placeholder="Search patients...">
<div class="cards" id="patientsContainer"></div>
</div>
</div>
</div>

<div id="doctorPage" style="display:none;">
<h2>Doctor Dashboard</h2>
<div class="cards" id="doctorPatients"></div>
</div>

<div id="patientPage" style="display:none;">
<h2>Patient Dashboard</h2>
<div class="cards" id="myCard"></div>
</div>
</div>

<script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-database.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyAIje3aPJK5BeZ9u0M-PY3rrZHPBZCsp7I",
  authDomain: "patient-app-9d81f.firebaseapp.com",
  databaseURL: "https://patient-app-9d81f-default-rtdb.firebaseio.com",
  projectId: "patient-app-9d81f",
  storageBucket: "patient-app-9d81f.appspot.com",
  messagingSenderId: "86486627512",
  appId: "1:86486627512:web:595270284159741947f04d"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

let currentUser = null;
let users = [];
let clinics = [];
let doctors = [];
let patients = [];

// Elements
const loginForm = document.getElementById("loginForm");
const loginEmail = document.getElementById("loginEmail");
const loginPassword = document.getElementById("loginPassword");
const loginRole = document.getElementById("loginRole");
const logoutBtn = document.getElementById("logoutBtn");
const authPage = document.getElementById("authPage");
const adminPage = document.getElementById("adminPage");
const doctorPage = document.getElementById("doctorPage");
const patientPage = document.getElementById("patientPage");

const clinicForm = document.getElementById("clinicForm");
const doctorForm = document.getElementById("doctorForm");
const patientForm = document.getElementById("patientForm");
const doctorClinic = document.getElementById("doctorClinic");
const patientDoctor = document.getElementById("patientDoctor");
const patientsContainer = document.getElementById("patientsContainer");
const doctorPatients = document.getElementById("doctorPatients");
const myCard = document.getElementById("myCard");
const searchBox = document.getElementById("searchBox");

// Fetch Firebase data
function fetchData(){
  db.ref('users').once('value', snap=>{
    users = [];
    snap.forEach(child=>users.push({...child.val(), id: child.key}));
  });
  db.ref('clinics').once('value', snap=>{
    clinics = [];
    snap.forEach(c=>clinics.push({...c.val(), id: c.key}));
    fillClinicOptions();
  });
  db.ref('doctors').once('value', snap=>{
    doctors = [];
    snap.forEach(d=>doctors.push({...d.val(), id: d.key}));
    fillDoctorOptions();
  });
  db.ref('patients').once('value', snap=>{
    patients = [];
    snap.forEach(p=>patients.push({...p.val(), id: p.key}));
    renderPatients();
    renderDoctorPatients();
    renderMyCard();
  });
}
fetchData();

function showPage(){
  authPage.style.display = currentUser ? "none":"flex";
  adminPage.style.display = currentUser && currentUser.role==='admin' ? "flex":"none";
  doctorPage.style.display = currentUser && currentUser.role==='doctor' ? "flex":"none";
  patientPage.style.display = currentUser && currentUser.role==='patient' ? "flex":"none";
  logoutBtn.style.display = currentUser ? 'inline-block':'none';
}

// Login
loginForm.addEventListener('submit', e=>{
  e.preventDefault();
  const email = loginEmail.value;
  const password = loginPassword.value;

  firebase.auth().signInWithEmailAndPassword(email,password)
    .then(res=>{
      db.ref('users/'+res.user.uid).once('value').then(snap=>{
        currentUser = snap.val();
        currentUser.id = res.user.uid;
        showPage();
      });
    })
    .catch(err=>{
      alert(err.message);
    });
});


// Add Clinic
clinicForm.addEventListener('submit', e=>{
  e.preventDefault();
  const clinic={
    name: clinicForm.clinicName.value,
    address: clinicForm.clinicAddress.value,
    phone: clinicForm.clinicPhone.value
  };
  const newRef = db.ref('clinics').push();
  newRef.set(clinic).then(()=>{
    alert('Clinic added');
    fetchData();
    clinicForm.reset();
  });
});

// Add Doctor
doctorForm.addEventListener('submit', e=>{
  e.preventDefault();
  const doctor={
    name: doctorForm.doctorName.value,
    email: doctorForm.doctorEmail.value,
    password: doctorForm.doctorPassword.value,
    clinicId: doctorClinic.value,
    role:'doctor'
  };
  const newRef = db.ref('doctors').push();
  newRef.set(doctor).then(()=>{
    alert('Doctor added');
    fetchData();
    doctorForm.reset();
  });
});

// Add Patient
patientForm.addEventListener('submit', e=>{
  e.preventDefault();
  const patient={
    name: patientForm.patientName.value,
    email: patientForm.patientEmail.value,
    password: patientForm.patientPassword.value,
    phone: patientForm.patientPhone.value,
    age: patientForm.patientAge.value,
    problem: patientForm.patientProblem.value,
    date: patientForm.patientDate.value,
    time: patientForm.patientTime.value,
    day: patientForm.patientDay.value,
    address: patientForm.patientAddress.value,
    doctorId: patientForm.patientDoctor.value,
    role:'patient'
  };
  const newRef = db.ref('patients').push();
  newRef.set(patient).then(()=>{
    alert('Patient added');
    fetchData();
    patientForm.reset();
  });
});

// Dropdowns
function fillClinicOptions(){
  doctorClinic.innerHTML = clinics.map(c=>`<option value="${c.id}">${c.name}</option>`).join('');
}
function fillDoctorOptions(){
  patientDoctor.innerHTML = doctors.map(d=>`<option value="${d.id}">${d.name}</option>`).join('');
}

// Render Patients
function renderPatients(){
  patientsContainer.innerHTML='';
  patients.forEach(p=>{
    let card=document.createElement('div');
    card.className='card';
    card.innerHTML=`<h3>${p.name}</h3><p><b>Email:</b>${p.email}</p><p><b>Phone:</b>${p.phone}</p><p><b>Age:</b>${p.age}</p><p><b>Problem:</b>${p.problem}</p><p><b>Date:</b>${p.date} ${p.time} (${p.day})</p><p><b>Address:</b>${p.address}</p><div><button class='outline' onclick="alert('SMS to ${p.phone}')">SMS</button><button class='outline' onclick="window.open('https://wa.me/${p.phone}','_blank')">WhatsApp</button></div>`;
    patientsContainer.appendChild(card);
  });
}
function renderDoctorPatients(){
  doctorPatients.innerHTML='';
  if(currentUser && currentUser.role==='doctor'){
    let pats = patients.filter(p=>p.doctorId==currentUser.id);
    pats.forEach(p=>{
      let card=document.createElement('div');
      card.className='card';
      card.innerHTML=`<h3>${p.name}</h3><p><b>Email:</b>${p.email}</p><p><b>Phone:</b>${p.phone}</p><p><b>Age:</b>${p.age}</p><p><b>Problem:</b>${p.problem}</p><p><b>Date:</b>${p.date} ${p.time} (${p.day})</p><p><b>Address:</b>${p.address}</p><div><button class='outline' onclick="alert('SMS to ${p.phone}')">SMS</button><button class='outline' onclick="window.open('https://wa.me/${p.phone}','_blank')">WhatsApp</button></div>`;
      doctorPatients.appendChild(card);
    });
  }
}
function renderMyCard(){
  myCard.innerHTML='';
  if(currentUser && currentUser.role==='patient'){
    let p = currentUser;
    let card=document.createElement('div');
    card.className='card';
    card.innerHTML=`<h3>${p.name}</h3><p><b>Email:</b>${p.email}</p><p><b>Phone:</b>${p.phone}</p><p><b>Age:</b>${p.age}</p><p><b>Problem:</b>${p.problem}</p><p><b>Date:</b>${p.date} ${p.time} (${p.day})</p><p><b>Address:</b>${p.address}</p><div><button class='outline' onclick="alert('SMS to ${p.phone}')">SMS</button><button class='outline' onclick="window.open('https://wa.me/${p.phone}','_blank')">WhatsApp</button></div>`;
    myCard.appendChild(card);
  }
}

// Search
searchBox.addEventListener('input', e=>{
  let q = e.target.value.toLowerCase();
  document.querySelectorAll('#patientsContainer .card').forEach(c=>c.style.display=c.textContent.toLowerCase().includes(q)?'flex':'none');
});

showPage();
</script>
</body>
</html>
